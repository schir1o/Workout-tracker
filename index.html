S=()=>{
try{
localStorage.setItem('p',JSON.stringify(p));
localStorage.setItem('w',JSON.stringify(w));
// Auto-save to GitHub if configured (mit Debouncing)
if(localStorage.<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="theme-color" content="#000">
<title>Darios Gym Ultimate</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
body{font:16px/1.5 -apple-system,BlinkMacSystemFont,sans-serif;background:#000;color:#fff;padding:env(safe-area-inset-top) 10px env(safe-area-inset-bottom);overscroll-behavior:none;touch-action:pan-y}
input,textarea{-webkit-user-select:text;user-select:text}
.c{max-width:100%;margin:0 auto}
.cd{background:#1c1c1e;border-radius:16px;padding:16px;margin-bottom:12px;position:relative;overflow:hidden}
.cd::before{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.1),transparent)}
.hd{background:linear-gradient(135deg,#007AFF,#0051D5);position:sticky;top:0;z-index:10;padding-top:calc(16px + env(safe-area-inset-top))}
.t{font:700 26px/1 system-ui}
.p{width:52px;height:52px;position:relative}
.p svg{transform:rotate(-90deg)}
.pt{position:absolute;inset:0;display:grid;place-items:center;font:600 12px/1 system-ui}
.r{display:flex;gap:8px;margin-top:16px;align-items:center;justify-content:center}
.arrow{width:40px;height:40px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.arrow:active{transform:scale(0.9)}
input,select,button,textarea{width:100%;padding:14px;background:#2c2c2e;border:1px solid #3a3a3c;border-radius:12px;color:#fff;font-size:17px;-webkit-appearance:none}
button{background:#007AFF;border:0;font-weight:600;cursor:pointer;transition:transform .1s}
button:active{transform:scale(0.96)}
.b{padding:10px;width:auto;font-size:15px}
.br{background:#FF3B30}
.bg{background:#34C759}
.bgy{background:#5A5A5E}
.bo{background:#FF9500}
.bp{background:#AF52DE}
.f{display:flex;gap:10px;align-items:center}
.fb{justify-content:space-between}
.e{background:#2c2c2e;border-radius:14px;padding:14px;margin-bottom:10px;animation:sl .3s}
@keyframes sl{from{opacity:0;transform:translateY(10px)}}
.eh{display:flex;justify-content:space-between;margin-bottom:12px;align-items:center}
.en{font:600 18px/1 system-ui}
.eb{background:#007AFF;padding:5px 12px;border-radius:20px;font:600 13px/1 system-ui;white-space:nowrap}
.s{display:grid;grid-template-columns:32px 1fr 75px 48px;gap:8px;align-items:center;padding:10px;background:#1c1c1e;border-radius:10px;margin-bottom:8px;transition:all .2s}
.s.d{background:linear-gradient(90deg,rgba(52,199,89,0.2),rgba(52,199,89,0.1));border:1px solid #30D158}
.sn{width:32px;height:32px;background:#007AFF;border-radius:50%;display:grid;place-items:center;font:600 15px/1 system-ui;flex-shrink:0}
.s.d .sn{background:#30D158}
.si{padding:10px;background:#000;border:1px solid #3a3a3c;border-radius:8px;text-align:center;font:600 17px/1 system-ui}
.si:focus{border-color:#007AFF;outline:0}
.ch{width:48px;height:38px;border-radius:10px;background:#1c1c1e;border:2px solid #3a3a3c;display:grid;place-items:center;cursor:pointer;font-size:20px;transition:all .2s;flex-shrink:0}
.ch.on{background:#30D158;border-color:#30D158;color:#fff}
.tb{display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:12px;background:#1c1c1e;padding:4px;border-radius:14px}
.ta{padding:12px;background:0;border:0;color:#8E8E93;font:600 15px/1 system-ui;cursor:pointer;border-radius:10px;transition:all .2s}
.ta.a{background:#007AFF;color:#fff}
.sg{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:16px}
.st{background:#2c2c2e;padding:18px;border-radius:14px;text-align:center;position:relative;overflow:hidden}
.st::after{content:'';position:absolute;bottom:0;left:0;right:0;height:3px;background:linear-gradient(90deg,#007AFF,#0051D5)}
.sv{font:700 28px/1 system-ui;color:#007AFF;margin-bottom:6px}
.sl{font:600 11px/1 system-ui;color:#8E8E93;text-transform:uppercase;letter-spacing:.5px}
.h{display:none!important}
.m{position:fixed;inset:0;background:rgba(0,0,0,0.95);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:999;display:none;align-items:flex-end;padding:0}
.m.o{display:flex}
.mc{background:#1c1c1e;border-radius:20px 20px 0 0;padding:24px;width:100%;max-height:80vh;overflow-y:auto;animation:su .3s;padding-bottom:calc(24px + env(safe-area-inset-bottom))}
@keyframes su{from{transform:translateY(100%)}}
.mh{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
.mh h3{font:600 20px/1 system-ui}
.x{width:32px;height:32px;border-radius:50%;background:#3a3a3c;border:0;color:#fff;cursor:pointer;font-size:20px}
.fg{margin-bottom:20px}
.l{display:block;margin-bottom:8px;font:600 12px/1 system-ui;color:#8E8E93;text-transform:uppercase;letter-spacing:.5px}
.ti{position:fixed;bottom:calc(20px + env(safe-area-inset-bottom));left:50%;transform:translateX(-50%);background:#1c1c1e;padding:14px 24px;border-radius:30px;box-shadow:0 8px 30px rgba(0,0,0,0.8);display:none;align-items:center;gap:16px;z-index:100;border:1px solid #3a3a3c}
.ti.o{display:flex}
.tt{font:700 22px/1 system-ui;min-width:70px;font-variant-numeric:tabular-nums}
.em{border:2px dashed #007AFF;background:rgba(0,122,255,0.08)}
.fab{position:fixed;bottom:calc(24px + env(safe-area-inset-bottom));right:20px;width:60px;height:60px;background:linear-gradient(135deg,#007AFF,#0051D5);border-radius:50%;display:none;place-items:center;font-size:28px;box-shadow:0 8px 30px rgba(0,122,255,0.5);cursor:pointer;z-index:90}
.fab.sh{display:grid}
.rt{text-align:center;padding:60px 20px;font:500 22px/1.4 system-ui;color:#8E8E93}
.mt{background:linear-gradient(135deg,#30D158,#34C759);padding:20px;border-radius:16px;text-align:center;font:600 18px/1.3 system-ui;margin-top:20px}
.qs{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:12px}
.qb{padding:0;width:48px;height:60px;border-radius:12px;font-size:24px;display:grid;place-items:center}
textarea{resize:none;font:16px/1.4 system-ui}
.hs{padding:16px;border-left:3px solid #007AFF;cursor:pointer;transition:all .2s}
.hs:active{transform:scale(0.98)}
.hst{font:600 11px/1 system-ui;color:#8E8E93;text-transform:uppercase;margin-bottom:4px}
.pr{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin-top:12px}
.prb{padding:8px;background:#2c2c2e;border:1px solid #3a3a3c;border-radius:8px;font:600 13px/1 system-ui;cursor:pointer;transition:all .2s}
.prb.a{background:#007AFF;border-color:#007AFF}
.wk{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.wd{padding:12px 4px;border-radius:8px;text-align:center;font:600 11px/1.2 system-ui;cursor:pointer;transition:all .2s;background:#2c2c2e;border:1px solid #3a3a3c}
.wd.td{background:#007AFF;color:#fff;border-color:#007AFF}
.wd.dn{background:#30D158;color:#fff;border-color:#30D158}
.wd.ps{background:#FF9500;color:#fff;border-color:#FF9500}
.sw{display:flex;gap:10px;align-items:center;justify-content:center;margin-bottom:12px}
.conf{position:fixed;top:50%;left:50%;font-size:100px;transform:translate(-50%,-50%);animation:cf 1s;pointer-events:none;z-index:9999}
@keyframes cf{0%{opacity:0;transform:translate(-50%,-50%) scale(0) rotate(0)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.5) rotate(180deg)}100%{opacity:0;transform:translate(-50%,-50%) scale(0.5) rotate(360deg)}}
.bdg{position:absolute;top:8px;right:8px;background:#FF3B30;color:#fff;font:600 10px/1 system-ui;padding:4px 8px;border-radius:10px}
.pls{animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
.empty{text-align:center;padding:40px;color:#8E8E93;font:500 16px/1.4 system-ui}
.tpl{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:16px}
.tplb{padding:12px;background:#2c2c2e;border:1px solid #3a3a3c;border-radius:12px;text-align:center;cursor:pointer;transition:all .2s}
.tplb:active{transform:scale(0.95)}
.tplb span{display:block;font-size:24px;margin-bottom:4px}
.tplb small{color:#8E8E93;font-size:12px}
.dt-display{padding:12px 20px;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.1);border-radius:8px;text-align:center;font:600 15px/1 system-ui;cursor:pointer;transition:all .2s;display:block}
.dt-display:active{transform:scale(0.98);background:rgba(255,255,255,0.08)}
.sup{vertical-align:super;font-size:0.7em;margin-left:2px}
.rpe{width:60px;padding:8px;background:#000;border:1px solid #3a3a3c;border-radius:8px;text-align:center;font:600 14px/1 system-ui}
.rpe:focus{border-color:#007AFF}
.rm{display:inline-block;background:#FF9500;color:#fff;padding:2px 8px;border-radius:12px;font:600 11px/1 system-ui;margin-left:8px}
</style>
</head>
<body>
<div class="c">
<div class="cd hd">
<div class="f fb">
<div class="t">üí™ Darios Gym</div>
<div class="p">
<svg width="52" height="52">
<circle cx="26" cy="26" r="22" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="4"/>
<circle cx="26" cy="26" r="22" fill="none" stroke="white" stroke-width="4" stroke-linecap="round" stroke-dasharray="138" stroke-dashoffset="138" id="pr"/>
</svg>
<div class="pt" id="pt">0%</div>
</div>
</div>
<div class="r">
<button class="arrow" onclick="CD(-1)" title="Vorheriger Tag">‚Üê</button>
<input type="date" id="dti" style="position:absolute;opacity:0;pointer-events:none" onchange="DTC(this.value)">
<label for="dti" class="dt-display" id="dtd" title="Datum ausw√§hlen"></label>
<button class="arrow" onclick="CD(1)" title="N√§chster Tag">‚Üí</button>
</div>
</div>

<div class="tb">
<button class="ta a" onclick="T('w')">Training</button>
<button class="ta" onclick="T('s')">Stats</button>
<button class="ta" onclick="T('g')">Grafik</button>
<button class="ta" onclick="T('h')">Verlauf</button>
</div>

<div id="w">
<div class="cd">
<div class="f fb">
<h2 id="wt" style="font:600 20px/1 system-ui">Loading...</h2>
<button class="b bgy" onclick="E()" id="eb">‚úèÔ∏è</button>
</div>
<div class="qs">
<button class="qb bgy" onclick="TM()" title="Timer starten">‚è±Ô∏è<small style="display:block;font-size:9px;margin-top:2px">Timer</small></button>
<button class="qb bgy" onclick="RS()" title="Alle zur√ºcksetzen">üîÑ<small style="display:block;font-size:9px;margin-top:2px">Reset</small></button>
<button class="qb bgy" onclick="CP()" title="Letztes Training kopieren">üìã<small style="display:block;font-size:9px;margin-top:2px">Kopieren</small></button>
<button class="qb bgy" onclick="NT()" title="Notizen hinzuf√ºgen">üìù<small style="display:block;font-size:9px;margin-top:2px">Notizen</small></button>
</div>
</div>
<div id="rt" class="cd rt h">üõå<br>Ruhetag - Regeneration ist wichtig!</div>
<div id="ex"></div>
<div class="cd mt pls" id="mot">üí™ Keep pushing, Dario!</div>
</div>

<div id="s" class="h">
<div class="sg">
<div class="st"><div class="sv" id="tw">0</div><div class="sl">Workouts</div></div>
<div class="st"><div class="sv" id="sk">0</div><div class="sl">Streak üî•</div></div>
<div class="st"><div class="sv" id="tk">0</div><div class="sl">Total KG</div></div>
</div>
<div class="sg">
<div class="st"><div class="sv" id="av">0</div><div class="sl">√ò kg/Set</div></div>
<div class="st"><div class="sv" id="tr">0</div><div class="sl">Total Reps</div></div>
<div class="st"><div class="sv" id="tt">0h</div><div class="sl">Zeit gesamt</div></div>
</div>
<div class="cd">
<div class="sw">
<button class="b bgy" onclick="CW(-1)">‚Üê</button>
<span id="wl" style="font:600 16px/1 system-ui">Diese Woche</span>
<button class="b bgy" onclick="CW(1)">‚Üí</button>
</div>
<div class="wk" id="wv"></div>
</div>
<div class="cd">
<h3 style="font:600 16px/1 system-ui;margin-bottom:12px">üèÜ Pers√∂nliche Bestleistungen</h3>
<div id="pbs"></div>
</div>
<div class="cd">
<h3 style="font:600 16px/1 system-ui;margin-bottom:12px">‚ö° Schnellstart</h3>
<div class="tpl">
<div class="tplb" onclick="LT('push')"><span>üèãÔ∏è</span><small>Push Day</small></div>
<div class="tplb" onclick="LT('pull')"><span>üí™</span><small>Pull Day</small></div>
<div class="tplb" onclick="LT('legs')"><span>ü¶µ</span><small>Leg Day</small></div>
<div class="tplb" onclick="LT('full')"><span>‚ö°</span><small>Full Body</small></div>
</div>
</div>
<div class="f" style="gap:10px;margin-top:16px">
<button onclick="XP()" class="bgy">üì§ Export</button>
<button onclick="IM()" class="bgy">üì• Import</button>
<button onclick="CS()" class="bg">‚òÅÔ∏è Cloud Setup</button>
<button onclick="RST()" class="br">üóëÔ∏è Reset</button>
</div>
</div>

<div id="g" class="h">
<div class="cd">
<h3 style="font:600 18px/1 system-ui;margin-bottom:16px">üìä Fortschritt</h3>
<select id="es" onchange="DC()" style="margin-bottom:16px">
<option value="">√úbung w√§hlen...</option>
</select>
<canvas id="cv" width="350" height="200" style="width:100%;border-radius:12px;background:#000"></canvas>
<div id="gd" style="margin-top:12px;font:600 14px/1.5 system-ui;color:#8E8E93"></div>
</div>
<div class="cd">
<h3 style="font:600 18px/1 system-ui;margin-bottom:12px">üìà Volumen-Analyse</h3>
<canvas id="vc" width="350" height="150" style="width:100%;border-radius:12px;background:#000"></canvas>
</div>
<div class="cd">
<h3 style="font:600 18px/1 system-ui;margin-bottom:12px">üí™ Muskelgruppen-Verteilung</h3>
<canvas id="mc" width="350" height="150" style="width:100%;border-radius:12px;background:#000"></canvas>
</div>
</div>

<div id="h" class="h">
<div class="cd">
<h3 style="font:600 18px/1 system-ui;margin-bottom:12px">Filter</h3>
<div class="pr" id="fltr"></div>
</div>
<div id="hl"></div>
</div>
</div>

<div class="fab h" id="fb" onclick="$('am').classList.add('o')" title="Neue √úbung hinzuf√ºgen">‚ûï</div>

<div class="ti" id="ti">
<div class="tt" id="tt">00:00</div>
<button class="b br" onclick="ST()">‚ñ†</button>
</div>

<div class="m" id="am" onclick="event.target.id=='am'&&CM('am')">
<div class="mc">
<div class="mh">
<h3>Neue √úbung</h3>
<button class="x" onclick="CM('am')">√ó</button>
</div>
<div class="fg">
<label class="l">Name</label>
<input id="nn" placeholder="z.B. Bankdr√ºcken" autocomplete="off">
</div>
<div class="fg">
<label class="l">S√§tze</label>
<input type="number" id="ns" value="3" min="1" max="10" inputmode="numeric">
</div>
<div class="fg">
<label class="l">Wiederholungen</label>
<input id="nr" value="8-12" placeholder="8-12" autocomplete="off">
</div>
<div class="fg">
<label class="l">Muskelgruppe</label>
<select id="nmg">
<option value="Brust">Brust</option>
<option value="R√ºcken">R√ºcken</option>
<option value="Beine">Beine</option>
<option value="Schultern">Schultern</option>
<option value="Arme">Arme</option>
<option value="Bauch">Bauch</option>
<option value="Andere">Andere</option>
</select>
</div>
<button onclick="AE()" style="padding:16px;font-size:17px">‚ûï Hinzuf√ºgen</button>
</div>
</div>

<div class="m" id="nm" onclick="event.target.id=='nm'&&CM('nm')">
<div class="mc">
<div class="mh">
<h3>Notizen</h3>
<button class="x" onclick="CM('nm')">√ó</button>
</div>
<textarea id="no" style="width:100%;height:180px;background:#000;border:1px solid #3a3a3c;border-radius:12px;padding:12px;color:#fff" placeholder="Notizen zum Training..." autocomplete="off"></textarea>
<button onclick="SN()" style="margin-top:16px;padding:16px;font-size:17px;width:100%">üíæ Speichern</button>
</div>
</div>

<script>
const $=i=>document.getElementById(i),$A=s=>document.querySelectorAll(s);
const WD=['Sonntag','Montag','Dienstag','Mittwoch','Donnerstag','Freitag','Samstag'];
const MO=['Mo','Di','Mi','Do','Fr','Sa','So'];
const MQ=['üí™ Keep pushing!','üî• Beast mode ON!','‚ö° No pain, no gain!','üéØ Focus & conquer!','üíØ Du schaffst das!','üöÄ To the moon!','üíé Stay strong!','ü¶æ Power durch!','‚≠ê Heute wird legend√§r!','üèÜ Champion mindset!'];
const TPL={
push:{e:[{n:'Bankdr√ºcken',s:4,r:'8-12',mg:'Brust'},{n:'Schr√§gbank',s:3,r:'10-12',mg:'Brust'},{n:'Fliegende',s:3,r:'12-15',mg:'Brust'},{n:'Schulterpresse',s:4,r:'8-12',mg:'Schultern'},{n:'Seitheben',s:3,r:'12-15',mg:'Schultern'},{n:'Trizeps-Dips',s:3,r:'10-12',mg:'Arme'}]},
pull:{e:[{n:'Klimmz√ºge',s:4,r:'6-10',mg:'R√ºcken'},{n:'Kreuzheben',s:4,r:'6-8',mg:'R√ºcken'},{n:'Rudern',s:4,r:'8-12',mg:'R√ºcken'},{n:'Latzug',s:3,r:'10-12',mg:'R√ºcken'},{n:'Bizepscurls',s:4,r:'10-12',mg:'Arme'},{n:'Hammercurls',s:3,r:'12-15',mg:'Arme'}]},
legs:{e:[{n:'Kniebeugen',s:4,r:'8-12',mg:'Beine'},{n:'Beinpresse',s:4,r:'10-12',mg:'Beine'},{n:'Beinstrecker',s:3,r:'12-15',mg:'Beine'},{n:'Beinbeuger',s:3,r:'12-15',mg:'Beine'},{n:'Wadenheben',s:4,r:'15-20',mg:'Beine'},{n:'Lunges',s:3,r:'10-12',mg:'Beine'}]},
full:{e:[{n:'Kniebeugen',s:3,r:'10',mg:'Beine'},{n:'Bankdr√ºcken',s:3,r:'10',mg:'Brust'},{n:'Klimmz√ºge',s:3,r:'8',mg:'R√ºcken'},{n:'Schulterpresse',s:3,r:'10',mg:'Schultern'},{n:'Plank',s:3,r:'60s',mg:'Bauch'}]}
};

let d=WD[new Date().getDay()],dt=new Date().toISOString().split('T')[0],em=0,ti,ts=0,v=navigator.vibrate?1:0,wo=0,cf='',gist=null;
const dp={
Montag:{t:'üî• Brust & Trizeps',e:[{n:'Brustpresse',s:4,r:'8-12',mg:'Brust'},{n:'Butterfly',s:4,r:'10-12',mg:'Brust'},{n:'Dips',s:4,r:'10-12',mg:'Brust'},{n:'Trizeps',s:3,r:'12-15',mg:'Arme'}]},
Dienstag:{t:'üí™ R√ºcken & Bizeps',e:[{n:'Latzug',s:4,r:'8-12',mg:'R√ºcken'},{n:'Rudern',s:4,r:'8-12',mg:'R√ºcken'},{n:'Klimmz√ºge',s:3,r:'6-10',mg:'R√ºcken'},{n:'Bizeps',s:4,r:'10-12',mg:'Arme'}]},
Mittwoch:{t:'ü¶µ Beine',e:[{n:'Beinpresse',s:4,r:'10-12',mg:'Beine'},{n:'Beinstrecker',s:4,r:'10-12',mg:'Beine'},{n:'Beinbeuger',s:4,r:'10-12',mg:'Beine'},{n:'Waden',s:4,r:'15-20',mg:'Beine'}]},
Donnerstag:{t:'üéØ Schultern',e:[{n:'Schulterpresse',s:4,r:'8-12',mg:'Schultern'},{n:'Seitheben',s:4,r:'12-15',mg:'Schultern'},{n:'Reverse Fly',s:4,r:'10-12',mg:'Schultern'}]},
Freitag:{t:'üí™ Arms',e:[{n:'Bizepscurls',s:4,r:'10-12',mg:'Arme'},{n:'Hammercurls',s:3,r:'10-12',mg:'Arme'},{n:'Trizeps',s:4,r:'12-15',mg:'Arme'}]},
Samstag:{t:'‚ö° Ganzk√∂rper',e:[{n:'Beinpresse',s:3,r:'12',mg:'Beine'},{n:'Brustpresse',s:3,r:'12',mg:'Brust'},{n:'Latzug',s:3,r:'12',mg:'R√ºcken'}]},
Sonntag:{t:'üò¥ Ruhetag',e:[],rt:1}
};
let p={...dp},w={};

const L=()=>{
try{
const sp=localStorage.getItem('p');
if(sp){
const parsed=JSON.parse(sp);
Object.keys(parsed).forEach(k=>{if(dp[k])p[k]=parsed[k]});
}
const sw=localStorage.getItem('w');
if(sw)w=JSON.parse(sw);
gist=localStorage.getItem('gist');
// Auto-load from cloud if configured
if(gist&&navigator.onLine){
CLoad();
}
}catch(e){console.log('Load error:',e)}
},
S=()=>{
try{
localStorage.setItem('p',JSON.stringify(p));
localStorage.setItem('w',JSON.stringify(w));
// Auto-save to GitHub if configured
if(localStorage.getItem('ghToken'))GHSave();
}catch(e){console.log('Save error:',e)}
},
K=()=>`${dt}-${d}`,
IW=()=>{
const k=K(),P=p[d];
if(!w[k]&&P&&!P.rt){
w[k]={e:P.e.map(x=>({...x,s:Array(x.s).fill().map(()=>({w:'',r:'',d:0}))})),n:'',st:Date.now()};
S();
}
},
V=n=>v&&navigator.vibrate&&navigator.vibrate(n||20),
SM=()=>$('mot').textContent=MQ[Math.floor(Math.random()*MQ.length)],
FD=()=>{
const date=new Date(dt+'T12:00');
const day=WD[date.getDay()];
const mo=MO[date.getDay()===0?6:date.getDay()-1];
const dd=date.getDate();
const mm=date.getMonth()+1;
const yy=date.getFullYear();
$('dtd').innerHTML=`${mo}, ${dd}.${mm<10?'0'+mm:mm}.${yy}`;
$('dti').value=dt;
return day;
},
CD=n=>{
const date=new Date(dt+'T12:00');
date.setDate(date.getDate()+n);
dt=date.toISOString().split('T')[0];
d=FD();
IW();
R();
},
C1RM=(w,r)=>{
if(!w||!r)return 0;
return Math.round(w/(1.0278-0.0278*r));
},
R=()=>{
const P=p[d],W=w[K()];
$('wt').textContent=P.t;
$('rt').classList.toggle('h',!P.rt);
$('fb').classList.toggle('sh',em&&!P.rt);
FD();

if(P.rt){
$('ex').innerHTML='';
UP(100);
return;
}

let c=0,t=0;
if(W&&W.e){
W.e.forEach(x=>x.s.forEach(s=>{t++;s.d&&c++}));
}
UP(t?(c/t)*100:0);

let h='';
if(!P.e||P.e.length===0){
h='<div class="cd empty">Keine √úbungen vorhanden<br><small>F√ºge √úbungen mit dem + Button hinzu</small></div>';
}else{
P.e.forEach((x,i)=>{
const E=W&&W.e?W.e[i]:null;
let maxRM=0;
if(E&&E.s){
E.s.forEach(s=>{
if(s.w&&s.r&&s.d){
const rm=C1RM(parseFloat(s.w),parseInt(s.r));
if(rm>maxRM)maxRM=rm;
}
});
}
h+=`<div class="e ${em?'em':''}">`;
if(em){
h+=`<input value="${x.n}" onchange="UE(${i},'n',this.value)" style="margin-bottom:12px">
<div class="f"><input type="number" value="${x.s}" min="1" max="10" onchange="UE(${i},'s',+this.value)" style="width:80px" inputmode="numeric">
<input value="${x.r}" onchange="UE(${i},'r',this.value)">
<button class="b br" onclick="RE(${i})">üóëÔ∏è</button></div>`;
}else{
h+=`<div class="eh"><div class="en">${x.n}${maxRM?`<span class="rm">1RM: ${maxRM}kg</span>`:''}</div><div class="eb">${x.mg||''}${x.mg?' ‚Ä¢ ':''}${x.s}√ó${x.r}</div></div>`;
if(E&&E.s){
E.s.forEach((s,j)=>{
h+=`<div class="s ${s.d?'d':''}"><div class="sn">${j+1}</div>
<input class="si" placeholder="kg" value="${s.w}" onchange="US(${i},${j},'w',this.value)" inputmode="decimal">
<input class="si" placeholder="Wdh" value="${s.r}" onchange="US(${i},${j},'r',this.value)" style="width:75px" inputmode="numeric">
<button class="ch ${s.d?'on':''}" onclick="TG(${i},${j})">${s.d?'‚úì':''}</button></div>`;
});
}
}
h+=`</div>`;
});
}
if(em)h+=`<button onclick="$('am').classList.add('o')" style="width:100%;margin-top:12px;padding:16px">‚ûï Neue √úbung</button>`;
$('ex').innerHTML=h;
},
UP=x=>{
$('pr').style.strokeDashoffset=138-x/100*138;
$('pt').textContent=Math.round(x)+'%';
if(x===100&&!document.querySelector('.conf')){
const e=document.createElement('div');
e.className='conf';
e.textContent='üéâ';
document.body.appendChild(e);
V([50,100,50]);
setTimeout(()=>e.remove(),1000);
}
},
US=(i,j,f,v)=>{
const k=K();
if(w[k]&&w[k].e&&w[k].e[i]&&w[k].e[i].s[j]){
w[k].e[i].s[j][f]=v;
S();
R();
}
},
TG=(i,j)=>{
const k=K();
if(w[k]&&w[k].e&&w[k].e[i]&&w[k].e[i].s[j]){
w[k].e[i].s[j].d=!w[k].e[i].s[j].d;
V();
S();
R();
}
},
UE=(i,f,v)=>{
if(p[d]&&p[d].e&&p[d].e[i]){
p[d].e[i][f]=v;
if(f==='s'){
const k=K();
if(w[k]&&w[k].e&&w[k].e[i]){
const oldSets=w[k].e[i].s||[];
w[k].e[i].s=Array(v).fill().map((_,j)=>oldSets[j]||{w:'',r:'',d:0});
}
}
S();
R();
}
},
RE=i=>{
if(confirm('√úbung wirklich l√∂schen?')){
p[d].e.splice(i,1);
const k=K();
if(w[k]&&w[k].e){
w[k].e.splice(i,1);
}
S();
R();
}
},
E=()=>{em=!em;$('eb').textContent=em?'üíæ':'‚úèÔ∏è';R()},
RS=()=>{
if(confirm('Alle Eintr√§ge zur√ºcksetzen?')){
const k=K();
if(w[k]&&w[k].e){
w[k].e.forEach(x=>x.s.forEach(s=>Object.assign(s,{w:'',r:'',d:0})));
S();
R();
}
}
},
CP=()=>{
const keys=Object.keys(w).filter(x=>x.endsWith(`-${d}`)&&x!==K()).sort().reverse();
if(keys.length>0){
const lastKey=keys[0];
const lastWorkout=w[lastKey];
const currentKey=K();
if(w[currentKey]&&w[currentKey].e&&lastWorkout&&lastWorkout.e){
let copied=false;
w[currentKey].e.forEach((ex,i)=>{
if(lastWorkout.e[i]&&lastWorkout.e[i].s){
ex.s.forEach((set,j)=>{
if(lastWorkout.e[i].s[j]){
const lastSet=lastWorkout.e[i].s[j];
if(lastSet.w||lastSet.r){
set.w=lastSet.w;
set.r=lastSet.r;
copied=true;
}
}
});
}
});
if(copied){
S();
R();
V([20,40]);
const e=document.createElement('div');
e.className='conf';
e.textContent='üìã';
document.body.appendChild(e);
setTimeout(()=>e.remove(),1000);
}else{
alert('Keine Daten zum Kopieren gefunden');
}
}
}else{
alert('Kein vorheriges Training gefunden');
}
},
TM=()=>{
ts=0;
$('ti').classList.add('o');
ti=setInterval(()=>{
ts++;
const m=Math.floor(ts/60);
const s=ts%60;
$('tt').textContent=`${m<10?'0'+m:m}:${s<10?'0'+s:s}`;
},1000);
},
ST=()=>{
clearInterval(ti);
$('ti').classList.remove('o');
const k=K();
if(w[k]){
w[k].et=Date.now();
w[k].d=ts;
S();
}
V([10,30,10]);
},
NT=()=>{
const k=K();
if(w[k]){
$('no').value=w[k].n||'';
}
$('nm').classList.add('o');
},
SN=()=>{
const k=K();
if(w[k]){
w[k].n=$('no').value;
S();
CM('nm');
}
},
AE=()=>{
const n=$('nn').value.trim();
const s=parseInt($('ns').value)||3;
const r=$('nr').value||'8-12';
const mg=$('nmg').value;
if(n){
if(!p[d].e)p[d].e=[];
p[d].e.push({n,s,r,mg});
$('nn').value='';
$('ns').value='3';
$('nr').value='8-12';
CM('am');
S();
IW();
R();
}
},
CM=i=>$(i).classList.remove('o'),
CW=n=>{wo+=n;SS()},
LT=t=>{
if(confirm(`${t.toUpperCase()} Template laden?`)){
p[d].e=TPL[t].e;
S();
IW();
R();
}
},
T=t=>{
$A('.ta').forEach(b=>b.classList.remove('a'));
event.target.classList.add('a');
['w','s','g','h'].forEach(i=>$(i).classList.add('h'));
$(t).classList.remove('h');
$('fb').classList.toggle('sh',t==='w'&&em&&!p[d].rt);
if(t==='s')SS();
if(t==='g')SG();
if(t==='h')SH();
},
SS=()=>{
// Stats
const tw=Object.keys(w).length;
$('tw').textContent=tw;
let kg=0,reps=0,sets=0,time=0;
Object.values(w).forEach(x=>{
if(x.e){
x.e.forEach(e=>{
if(e.s){
e.s.forEach(s=>{
if(s.d&&s.w&&s.r){
kg+=parseFloat(s.w)*parseInt(s.r);
reps+=parseInt(s.r);
sets++;
}
});
}
});
}
if(x.d)time+=x.d;
});
$('tk').textContent=Math.round(kg);
$('tr').textContent=reps;
$('av').textContent=sets?Math.round(kg/sets):'0';
$('tt').textContent=time?`${Math.round(time/3600)}h`:'0h';

let sk=0;
const today=new Date();
for(let i=0;i<30;i++){
const checkDate=new Date(today);
checkDate.setDate(today.getDate()-i);
const dateStr=checkDate.toISOString().split('T')[0];
if(Object.keys(w).some(k=>k.startsWith(dateStr))){
sk++;
}else if(i>0){
break;
}
}
$('sk').textContent=sk;

// Wochenansicht
const currentDate=new Date();
const weekDay=currentDate.getDay();
const monday=new Date(currentDate);
monday.setDate(currentDate.getDate()-(weekDay||7)+1+wo*7);
$('wl').textContent=wo===0?'Diese Woche':wo<0?`Vor ${-wo} Woche${wo<-1?'n':''}`:`In ${wo} Woche${wo>1?'n':''}`;
let weekHtml='';
for(let i=0;i<7;i++){
const dayDate=new Date(monday);
dayDate.setDate(monday.getDate()+i);
const dateStr=dayDate.toISOString().split('T')[0];
const dayName=WD[dayDate.getDay()];
const workoutKey=`${dateStr}-${dayName}`;
const hasWorkout=w[workoutKey];
const isToday=dateStr===new Date().toISOString().split('T')[0];
let status='';
if(hasWorkout&&hasWorkout.e){
const total=hasWorkout.e.reduce((a,e)=>a+(e.s?e.s.length:0),0);
const completed=hasWorkout.e.reduce((a,e)=>a+(e.s?e.s.filter(s=>s.d).length:0),0);
status=total?`${Math.round(completed/total*100)}%`:'';
}
weekHtml+=`<div class="wd ${hasWorkout?'dn':isToday?'td':''}" onclick="JD('${dateStr}','${dayName}')">${MO[dayDate.getDay()===0?6:dayDate.getDay()-1]}<br>${dayDate.getDate()}${status?`<br>${status}`:''}</div>`;
}
$('wv').innerHTML=weekHtml;

// Personal Bests
const pbs={};
Object.values(w).forEach(workout=>{
if(workout.e){
workout.e.forEach(exercise=>{
if(exercise.s){
exercise.s.forEach(set=>{
if(set.w&&set.d){
const weight=parseFloat(set.w);
if(!pbs[exercise.n]||weight>pbs[exercise.n]){
pbs[exercise.n]=weight;
}
}
});
}
});
}
});
let pbHtml='';
Object.entries(pbs).sort((a,b)=>b[1]-a[1]).slice(0,5).forEach(([name,weight])=>{
pbHtml+=`<div style="padding:8px 0;border-bottom:1px solid #3a3a3c"><span style="color:#8E8E93">${name}:</span> <strong>${weight}kg</strong></div>`;
});
$('pbs').innerHTML=pbHtml||'<div style="color:#8E8E93">Noch keine Bestleistungen</div>';
},
JD=(dateStr,dayName)=>{
dt=dateStr;
d=dayName;
FD();
T('w');
IW();
R();
},
SG=()=>{
// √úbungen sammeln
const exercises=new Set();
Object.values(w).forEach(workout=>{
if(workout.e){
workout.e.forEach(exercise=>{
if(exercise.n)exercises.add(exercise.n);
});
}
});
let options='<option value="">√úbung w√§hlen...</option>';
exercises.forEach(ex=>options+=`<option value="${ex}">${ex}</option>`);
$('es').innerHTML=options;
DC();
DV();
DM();
},
DC=()=>{
const exerciseName=$('es').value;
const canvas=$('cv');
const ctx=canvas.getContext('2d');
ctx.clearRect(0,0,350,200);
if(!exerciseName){
$('gd').innerHTML='';
return;
}

// Daten sammeln
const data=[];
Object.keys(w).sort().forEach(key=>{
const[dateStr,dayName]=key.split('-');
if(w[key]&&w[key].e){
w[key].e.forEach(exercise=>{
if(exercise.n===exerciseName&&exercise.s){
const maxWeight=Math.max(...exercise.s.filter(s=>s.w&&s.d).map(s=>parseFloat(s.w)||0));
if(maxWeight>0){
data.push({d:dateStr,w:maxWeight});
}
}
});
}
});

if(data.length===0){
$('gd').innerHTML='<span style="color:#8E8E93">Keine Daten vorhanden</span>';
return;
}

// Chart zeichnen
const maxWeight=Math.max(...data.map(d=>d.w));
const minWeight=Math.min(...data.map(d=>d.w));
const padding=30;
const width=(350-padding*2)/Math.max(data.length-1,1);
const height=200-padding*2;

// Grid
ctx.strokeStyle='#2c2c2e';
ctx.lineWidth=1;
for(let i=0;i<=4;i++){
const y=padding+height*i/4;
ctx.beginPath();
ctx.moveTo(padding,y);
ctx.lineTo(350-padding,y);
ctx.stroke();
ctx.fillStyle='#8E8E93';
ctx.font='10px system-ui';
ctx.fillText(Math.round(maxWeight-i*(maxWeight-minWeight)/4)+'kg',2,y+3);
}

// Gradient
const gradient=ctx.createLinearGradient(0,padding,0,200);
gradient.addColorStop(0,'rgba(0,122,255,0.3)');
gradient.addColorStop(1,'rgba(0,122,255,0)');

// Fl√§che
ctx.fillStyle=gradient;
ctx.beginPath();
ctx.moveTo(padding,200-padding);
data.forEach((d,i)=>{
const x=padding+i*width;
const y=padding+height*(1-(d.w-minWeight)/(maxWeight-minWeight||1));
ctx.lineTo(x,y);
});
ctx.lineTo(padding+(data.length-1)*width,200-padding);
ctx.closePath();
ctx.fill();

// Linie
ctx.strokeStyle='#007AFF';
ctx.lineWidth=3;
ctx.beginPath();
data.forEach((d,i)=>{
const x=padding+i*width;
const y=padding+height*(1-(d.w-minWeight)/(maxWeight-minWeight||1));
if(i===0)ctx.moveTo(x,y);
else ctx.lineTo(x,y);
});
ctx.stroke();

// Punkte
data.forEach((d,i)=>{
const x=padding+i*width;
const y=padding+height*(1-(d.w-minWeight)/(maxWeight-minWeight||1));
ctx.fillStyle='#007AFF';
ctx.beginPath();
ctx.arc(x,y,5,0,Math.PI*2);
ctx.fill();
ctx.fillStyle='#fff';
ctx.beginPath();
ctx.arc(x,y,3,0,Math.PI*2);
ctx.fill();
});

// Info
const diff=data[data.length-1].w-data[0].w;
const percent=data[0].w?Math.round(diff/data[0].w*100):0;
$('gd').innerHTML=`
<div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;text-align:center">
<div><span style="color:#8E8E93">Start</span><br><strong>${data[0].w}kg</strong></div>
<div><span style="color:#8E8E93">Aktuell</span><br><strong style="color:#007AFF">${data[data.length-1].w}kg</strong></div>
<div><span style="color:#8E8E93">Fortschritt</span><br><strong style="color:${diff>=0?'#30D158':'#FF3B30'}">${diff>0?'+':''}${diff}kg (${percent>0?'+':''}${percent}%)</strong></div>
</div>`;
},
DV=()=>{
// Volumen Chart
const canvas=$('vc');
const ctx=canvas.getContext('2d');
ctx.clearRect(0,0,350,150);
const volumeData=[];
const today=new Date();
for(let i=6;i>=0;i--){
const checkDate=new Date(today);
checkDate.setDate(today.getDate()-i);
const dateStr=checkDate.toISOString().split('T')[0];
let volume=0;
Object.keys(w).forEach(key=>{
if(key.startsWith(dateStr)&&w[key]&&w[key].e){
w[key].e.forEach(exercise=>{
if(exercise.s){
exercise.s.forEach(set=>{
if(set.d&&set.w&&set.r){
volume+=parseFloat(set.w)*parseInt(set.r);
}
});
}
});
}
});
volumeData.push({d:checkDate.getDate(),v:volume});
}
const maxVolume=Math.max(...volumeData.map(d=>d.v),1);
const padding=20;
const barWidth=(350-padding*2)/7;
const height=150-padding*2;

// Bars
volumeData.forEach((d,i)=>{
const x=padding+i*barWidth+barWidth*0.2;
const w=barWidth*0.6;
const y=padding+height*(1-d.v/maxVolume);
const barHeight=height*d.v/maxVolume;
const gradient=ctx.createLinearGradient(0,y,0,y+barHeight);
gradient.addColorStop(0,'#007AFF');
gradient.addColorStop(1,'#0051D5');
ctx.fillStyle=gradient;
ctx.fillRect(x,y,w,barHeight);
ctx.fillStyle='#8E8E93';
ctx.font='10px system-ui';
ctx.textAlign='center';
ctx.fillText(d.d,x+w/2,145);
if(d.v>0){
ctx.fillStyle='#fff';
ctx.font='9px system-ui';
ctx.fillText(Math.round(d.v),x+w/2,y-5);
}
});
},
DM=()=>{
// Muskelgruppen Chart
const canvas=$('mc');
const ctx=canvas.getContext('2d');
ctx.clearRect(0,0,350,150);
const muscleGroups={};
Object.values(w).forEach(workout=>{
if(workout.e){
workout.e.forEach(exercise=>{
if(exercise.mg&&exercise.s){
if(!muscleGroups[exercise.mg])muscleGroups[exercise.mg]=0;
exercise.s.forEach(set=>{
if(set.d)muscleGroups[exercise.mg]++;
});
}
});
}
});
const entries=Object.entries(muscleGroups).sort((a,b)=>b[1]-a[1]);
if(entries.length===0)return;
const maxSets=Math.max(...entries.map(e=>e[1]));
const colors=['#007AFF','#34C759','#FF9500','#AF52DE','#FF3B30','#FFD60A'];
const padding=20;
const barWidth=(350-padding*2)/entries.length;
const height=150-padding*2;

entries.forEach(([muscle,sets],i)=>{
const x=padding+i*barWidth+barWidth*0.15;
const w=barWidth*0.7;
const y=padding+height*(1-sets/maxSets);
const barHeight=height*sets/maxSets;
ctx.fillStyle=colors[i%colors.length];
ctx.fillRect(x,y,w,barHeight);
ctx.fillStyle='#fff';
ctx.font='10px system-ui';
ctx.textAlign='center';
ctx.fillText(sets,x+w/2,y-5);
ctx.fillStyle='#8E8E93';
ctx.font='9px system-ui';
ctx.fillText(muscle.substr(0,4),x+w/2,145);
});
},
SH=()=>{
// Filter
const muscleGroups=new Set();
Object.values(w).forEach(workout=>{
if(workout.e){
workout.e.forEach(exercise=>{
if(exercise.mg)muscleGroups.add(exercise.mg);
});
}
});
let filterHtml='<button class="prb a" onclick="CF(\'\')">Alle</button>';
muscleGroups.forEach(mg=>filterHtml+=`<button class="prb" onclick="CF('${mg}')">${mg}</button>`);
$('fltr').innerHTML=filterHtml;
FH();
},
CF=filter=>{
cf=filter;
$A('#fltr .prb').forEach(btn=>{
btn.classList.toggle('a',btn.textContent==='Alle'?!filter:btn.textContent===filter);
});
FH();
},
FH=()=>{
const keys=Object.keys(w).sort().reverse();
let html='';
if(keys.length===0){
html='<div class="cd empty">Noch keine Trainings aufgezeichnet<br><small>Starte dein erstes Training!</small></div>';
}else{
keys.slice(0,30).forEach(key=>{
const[dateStr,dayName]=key.split('-');
const workout=w[key];
if(!workout||!workout.e)return;
if(cf&&!workout.e.some(e=>e.mg===cf))return;
let completed=0,total=0,volume=0;
workout.e.forEach(exercise=>{
if(exercise.s){
exercise.s.forEach(set=>{
total++;
if(set.d){
completed++;
if(set.w&&set.r){
volume+=parseFloat(set.w)*parseInt(set.r);
}
}
});
}
});
const percent=total?Math.round(completed/total*100):0;
const duration=workout.st?(workout.et||Date.now())-workout.st:0;
const date=new Date(dateStr+'T12:00');
html+=`<div class="cd hs" onclick="JD('${dateStr}','${dayName}')">
<div class="hst">${dayName} ‚Ä¢ ${date.getDate()}.${date.getMonth()+1}.${date.getFullYear()}</div>
<div style="font:700 24px/1 system-ui;color:${percent>80?'#30D158':percent>50?'#007AFF':'#FF9500'}">${percent}%</div>
<div style="font:600 13px/1 system-ui;color:#8E8E93;margin-top:4px">${completed}/${total} Sets${volume?` ‚Ä¢ ${Math.round(volume)}kg`:''}${workout.n?' ‚Ä¢ üìù':''}${duration?` ‚Ä¢ ${Math.round(duration/60000)}min`:''}</div>
</div>`;
});
}
$('hl').innerHTML=html;
},
RST=()=>{
if(confirm('ALLE Daten l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden!')){
if(confirm('Wirklich ALLE Daten unwiderruflich l√∂schen?')){
localStorage.clear();
location.reload();
}
}
},
XP=()=>{
const exportData={p,w,v:2,d:new Date()};
const dataStr=JSON.stringify(exportData,null,2);
const blob=new Blob([dataStr],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`gym-backup-${new Date().toISOString().split('T')[0]}.json`;
a.click();
URL.revokeObjectURL(url);
// Zus√§tzlich: Link zum Teilen generieren
const shareData=btoa(encodeURIComponent(dataStr));
if(navigator.share&&shareData.length<100000){
navigator.share({
title:'Gym Backup',
text:`Backup vom ${new Date().toLocaleDateString()}`,
files:[new File([blob],a.download,{type:'application/json'})]
}).catch(()=>{});
}
V([20,40,20]);
},
IM=()=>{
const input=document.createElement('input');
input.type='file';
input.accept='.json';
input.onchange=e=>{
const reader=new FileReader();
reader.onload=event=>{
try{
const importData=JSON.parse(event.target.result);
if(importData.p)p=importData.p;
if(importData.w)w=importData.w;
S();
R();
SS();
V([50,100,50]);
alert('Import erfolgreich!');
}catch(err){
alert('Fehler beim Import: '+err.message);
}
};
reader.readAsText(e.target.files[0]);
};
input.click();
},
CS=()=>{
const modal=document.createElement('div');
modal.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px';
modal.innerHTML=`
<div style="background:#1c1c1e;border-radius:20px;padding:24px;max-width:400px;width:100%">
<h3 style="font:600 20px/1 system-ui;margin-bottom:20px">‚òÅÔ∏è GitHub Sync Setup</h3>
<p style="color:#8E8E93;margin-bottom:16px">1. Gehe zu GitHub ‚Üí Settings ‚Üí Developer Settings ‚Üí Personal Access Tokens<br>2. Erstelle Token mit "repo" Rechten<br>3. Erstelle Repository "gym-data"</p>
<input id="gh-token" type="password" placeholder="GitHub Token" value="${localStorage.getItem('ghToken')||''}" style="width:100%;padding:14px;background:#000;border:1px solid #3a3a3c;border-radius:8px;color:#fff;margin-bottom:12px">
<input id="gh-user" placeholder="GitHub Username" value="${localStorage.getItem('ghUser')||''}" style="width:100%;padding:14px;background:#000;border:1px solid #3a3a3c;border-radius:8px;color:#fff;margin-bottom:12px">
<button onclick="GHSave()" style="width:100%;padding:14px;background:#007AFF;border:0;border-radius:8px;color:#fff;font:600 16px/1 system-ui">Speichern & Sync</button>
<button onclick="this.parentElement.remove()" style="width:100%;margin-top:10px;padding:14px;background:#5A5A5E;border:0;border-radius:8px;color:#fff">Abbrechen</button>
</div>`;
document.body.appendChild(modal);
},
GHSave=async()=>{
const token=$('gh-token')?.value||localStorage.getItem('ghToken');
const user=$('gh-user')?.value||localStorage.getItem('ghUser');
if(!token||!user)return;
localStorage.setItem('ghToken',token);
localStorage.setItem('ghUser',user);
const data=btoa(JSON.stringify({p,w,v:3,d:new Date()}));
try{
await fetch(`https://api.github.com/repos/${user}/Workout-tracker/contents/data.json`,{
method:'PUT',
headers:{'Authorization':`token ${token}`,'Content-Type':'application/json'},
body:JSON.stringify({message:'Update gym data',content:data,sha:await GHGetSHA()})
});
if($('gh-token'))alert('Gespeichert in GitHub!');
if($('gh-token'))document.querySelector('[onclick*="GHSave"]').parentElement.remove();
}catch(e){console.log('Save error:',e)}
},
GHGetSHA=async()=>{
const token=localStorage.getItem('ghToken');
const user=localStorage.getItem('ghUser');
try{
const res=await fetch(`https://api.github.com/repos/${user}/Workout-tracker/contents/data.json`,{
headers:{'Authorization':`token ${token}`}
});
if(res.ok){
const data=await res.json();
return data.sha;
}
}catch(e){}
return null;
},
GHLoad=async()=>{
const token=localStorage.getItem('ghToken');
const user=localStorage.getItem('ghUser');
if(!token||!user)return;
try{
const res=await fetch(`https://api.github.com/repos/${user}/Workout-tracker/contents/data.json`,{
headers:{'Authorization':`token ${token}`}
});
if(res.ok){
const data=await res.json();
const content=JSON.parse(atob(data.content));
if(content.p)p=content.p;
if(content.w)w=content.w;
S();R();
}
}catch(e){console.log('Load error:',e)}
},

// Events
const DTC=v=>{
dt=v;
d=FD();
IW();
R();
};

// Swipe Detection f√ºr Tab-Navigation
let touchStartX=0,touchEndX=0;
document.addEventListener('touchstart',e=>{touchStartX=e.changedTouches[0].screenX},false);
document.addEventListener('touchend',e=>{
touchEndX=e.changedTouches[0].screenX;
const diff=touchStartX-touchEndX;
if(Math.abs(diff)>100){
const tabs=['w','s','g','h'];
const current=tabs.findIndex(t=>!$(t).classList.contains('h'));
if(diff>0&&current<tabs.length-1){
T(tabs[current+1]);
$A('.ta')[current+1].click();
}else if(diff<0&&current>0){
T(tabs[current-1]);
$A('.ta')[current-1].click();
}
}
},false);

// Init
L();
// Auto-load from GitHub on start
if(localStorage.getItem('ghToken'))GHLoad();
FD();
IW();
R();
SM();
setInterval(SM,30000);

// PWA
if('serviceWorker' in navigator){
navigator.serviceWorker.register('data:text/javascript,self.addEventListener("install",e=>e.waitUntil(self.skipWaiting()));self.addEventListener("activate",e=>e.waitUntil(self.clients.claim()));self.addEventListener("fetch",e=>{});').catch(()=>{});
}

// Prevent zoom
let lastTouch=0;
document.addEventListener('touchend',e=>{
const now=Date.now();
if(now-lastTouch<=300)e.preventDefault();
lastTouch=now;
},false);

// Auto-save
document.addEventListener('visibilitychange',()=>{
if(document.hidden)S();
});

// Workout reminder notification (wenn m√∂glich)
if('Notification' in window && Notification.permission === 'default'){
Notification.requestPermission();
}
</script>
</body>
</html>
