<!DOCTYPE html>

<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a2e">
    <title>Mein Tagebuch</title>
    <style>
        :root {
            --primary: #6c5ce7;
            --primary-light: #a29bfe;
            --secondary: #00cec9;
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --bg-input: #0f3460;
            --text-primary: #ffffff;
            --text-secondary: #b2bec3;
            --accent-happy: #00b894;
            --accent-neutral: #fdcb6e;
            --accent-sad: #74b9ff;
            --accent-angry: #e17055;
            --accent-love: #fd79a8;
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
            --radius: 16px;
        }

```
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        min-height: 100dvh;
        overflow-x: hidden;
    }

    /* Header */
    .header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        padding: 16px 20px;
        background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-card) 100%);
        backdrop-filter: blur(10px);
        z-index: 100;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header h1 {
        font-size: 1.4rem;
        font-weight: 600;
        background: linear-gradient(135deg, var(--primary-light), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .header-actions {
        display: flex;
        gap: 12px;
    }

    .icon-btn {
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: none;
        background: var(--bg-input);
        color: var(--text-primary);
        font-size: 1.2rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .icon-btn:hover, .icon-btn:active {
        background: var(--primary);
        transform: scale(1.05);
    }

    /* Main Content */
    .main {
        padding: 80px 16px 100px;
    }

    /* Stats Bar */
    .stats-bar {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 12px;
        margin-bottom: 24px;
    }

    .stat-card {
        background: var(--bg-card);
        padding: 16px;
        border-radius: var(--radius);
        text-align: center;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-light);
    }

    .stat-label {
        font-size: 0.75rem;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    /* Entry Cards */
    .entries-container {
        display: flex;
        flex-direction: column;
        gap: 16px;
    }

    .entry-card {
        background: var(--bg-card);
        border-radius: var(--radius);
        padding: 20px;
        box-shadow: var(--shadow);
        transition: transform 0.2s;
        position: relative;
        overflow: hidden;
    }

    .entry-card::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
    }

    .entry-card.mood-happy::before { background: var(--accent-happy); }
    .entry-card.mood-neutral::before { background: var(--accent-neutral); }
    .entry-card.mood-sad::before { background: var(--accent-sad); }
    .entry-card.mood-angry::before { background: var(--accent-angry); }
    .entry-card.mood-love::before { background: var(--accent-love); }

    .entry-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }

    .entry-date {
        font-size: 0.85rem;
        color: var(--text-secondary);
    }

    .entry-mood {
        font-size: 1.5rem;
    }

    .entry-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .entry-preview {
        font-size: 0.9rem;
        color: var(--text-secondary);
        line-height: 1.5;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .entry-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
    }

    .tag {
        padding: 4px 12px;
        background: var(--bg-input);
        border-radius: 20px;
        font-size: 0.75rem;
        color: var(--primary-light);
    }

    .entry-actions {
        display: flex;
        gap: 8px;
        margin-top: 16px;
        padding-top: 12px;
        border-top: 1px solid rgba(255,255,255,0.1);
    }

    .entry-actions button {
        flex: 1;
        padding: 10px;
        border: none;
        border-radius: 10px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-edit {
        background: var(--bg-input);
        color: var(--text-primary);
    }

    .btn-delete {
        background: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
    }

    /* FAB Button */
    .fab {
        position: fixed;
        bottom: 24px;
        right: 24px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
        color: white;
        font-size: 2rem;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(108, 92, 231, 0.5);
        z-index: 99;
        transition: all 0.3s;
    }

    .fab:hover, .fab:active {
        transform: scale(1.1) rotate(90deg);
    }

    /* Modal */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.8);
        z-index: 200;
        display: none;
        align-items: flex-end;
        justify-content: center;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal {
        background: var(--bg-card);
        width: 100%;
        max-width: 500px;
        max-height: 90vh;
        border-radius: 24px 24px 0 0;
        padding: 24px;
        overflow-y: auto;
        animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
        from { transform: translateY(100%); }
        to { transform: translateY(0); }
    }

    .modal-handle {
        width: 40px;
        height: 4px;
        background: var(--text-secondary);
        border-radius: 2px;
        margin: 0 auto 20px;
    }

    .modal-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 24px;
        text-align: center;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-label {
        display: block;
        font-size: 0.85rem;
        color: var(--text-secondary);
        margin-bottom: 8px;
    }

    .form-input {
        width: 100%;
        padding: 14px 16px;
        background: var(--bg-input);
        border: 2px solid transparent;
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
        transition: border-color 0.2s;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary);
    }

    textarea.form-input {
        min-height: 150px;
        resize: vertical;
        font-family: inherit;
        line-height: 1.6;
    }

    /* Mood Selector */
    .mood-selector {
        display: flex;
        justify-content: space-between;
        gap: 8px;
    }

    .mood-option {
        flex: 1;
        padding: 12px 8px;
        background: var(--bg-input);
        border: 2px solid transparent;
        border-radius: 12px;
        font-size: 1.5rem;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
    }

    .mood-option:hover {
        transform: scale(1.1);
    }

    .mood-option.selected {
        border-color: var(--primary);
        background: rgba(108, 92, 231, 0.2);
    }

    .mood-option span {
        display: block;
        font-size: 0.65rem;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    /* Tags Input */
    .tags-input-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 12px;
        background: var(--bg-input);
        border-radius: 12px;
        min-height: 50px;
    }

    .tags-input-container .tag {
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .tag-remove {
        cursor: pointer;
        opacity: 0.7;
    }

    .tags-input {
        flex: 1;
        min-width: 100px;
        background: transparent;
        border: none;
        color: var(--text-primary);
        font-size: 0.9rem;
        outline: none;
    }

    /* Save Button */
    .btn-save {
        width: 100%;
        padding: 16px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
        border-radius: 12px;
        color: white;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        margin-top: 8px;
        transition: all 0.2s;
    }

    .btn-save:hover, .btn-save:active {
        transform: translateY(-2px);
        box-shadow: 0 4px 20px rgba(108, 92, 231, 0.4);
    }

    /* Search & Filter Modal */
    .search-container {
        padding: 16px;
        background: var(--bg-card);
        border-radius: var(--radius);
        margin-bottom: 20px;
    }

    .search-input {
        width: 100%;
        padding: 14px 16px 14px 44px;
        background: var(--bg-input);
        border: none;
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
    }

    .search-wrapper {
        position: relative;
    }

    .search-wrapper::before {
        content: 'üîç';
        position: absolute;
        left: 14px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.1rem;
    }

    .filter-chips {
        display: flex;
        gap: 8px;
        margin-top: 12px;
        overflow-x: auto;
        padding-bottom: 4px;
    }

    .filter-chip {
        padding: 8px 16px;
        background: var(--bg-input);
        border: none;
        border-radius: 20px;
        color: var(--text-secondary);
        font-size: 0.85rem;
        white-space: nowrap;
        cursor: pointer;
        transition: all 0.2s;
    }

    .filter-chip.active {
        background: var(--primary);
        color: white;
    }

    /* View Entry Modal */
    .view-modal .entry-full-content {
        line-height: 1.8;
        white-space: pre-wrap;
        color: var(--text-primary);
    }

    .view-modal .entry-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 16px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
    }

    .empty-state-icon {
        font-size: 4rem;
        margin-bottom: 16px;
    }

    .empty-state h2 {
        font-size: 1.2rem;
        margin-bottom: 8px;
    }

    .empty-state p {
        color: var(--text-secondary);
        font-size: 0.9rem;
    }

    /* Calendar View */
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 4px;
        margin-bottom: 20px;
    }

    .calendar-header {
        text-align: center;
        font-size: 0.75rem;
        color: var(--text-secondary);
        padding: 8px 0;
    }

    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 8px;
        font-size: 0.85rem;
        background: var(--bg-input);
        cursor: pointer;
        position: relative;
    }

    .calendar-day.has-entry {
        background: var(--primary);
    }

    .calendar-day.today {
        border: 2px solid var(--secondary);
    }

    .calendar-day.other-month {
        opacity: 0.3;
    }

    .calendar-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
    }

    .calendar-nav h3 {
        font-size: 1.1rem;
    }

    .calendar-nav button {
        padding: 8px 16px;
        background: var(--bg-input);
        border: none;
        border-radius: 8px;
        color: var(--text-primary);
        cursor: pointer;
    }

    /* Export Modal */
    .export-options {
        display: grid;
        gap: 12px;
    }

    .export-btn {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px;
        background: var(--bg-input);
        border: none;
        border-radius: 12px;
        color: var(--text-primary);
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .export-btn:hover {
        background: var(--primary);
    }

    .export-btn span.icon {
        font-size: 1.5rem;
    }

    /* Bottom Nav */
    .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--bg-card);
        padding: 12px 20px;
        padding-bottom: max(12px, env(safe-area-inset-bottom));
        display: flex;
        justify-content: space-around;
        border-top: 1px solid rgba(255,255,255,0.1);
        z-index: 98;
    }

    .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 0.7rem;
        cursor: pointer;
        transition: color 0.2s;
        padding: 4px 12px;
    }

    .nav-item.active {
        color: var(--primary-light);
    }

    .nav-item span.icon {
        font-size: 1.4rem;
    }

    /* Toast */
    .toast {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%) translateY(100px);
        background: var(--bg-card);
        padding: 14px 24px;
        border-radius: 12px;
        box-shadow: var(--shadow);
        z-index: 300;
        opacity: 0;
        transition: all 0.3s;
    }

    .toast.show {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }

    /* Dark/Light Theme Toggle */
    .theme-toggle {
        position: relative;
    }

    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .entry-card {
        animation: fadeIn 0.3s ease forwards;
    }

    /* Responsive */
    @media (min-width: 768px) {
        .main {
            max-width: 600px;
            margin: 0 auto;
        }
    }
</style>
```

</head>
<body>
    <!-- Header -->
    <header class="header">
        <h1>üìî Mein Tagebuch</h1>
        <div class="header-actions">
            <button class="icon-btn" onclick="showExportModal()" title="Exportieren">üì§</button>
            <button class="icon-btn" onclick="toggleTheme()" title="Theme wechseln">üåô</button>
        </div>
    </header>

```
<!-- Main Content -->
<main class="main" id="mainContent">
    <!-- Stats -->
    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-value" id="totalEntries">0</div>
            <div class="stat-label">Eintr√§ge</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="currentStreak">0</div>
            <div class="stat-label">Tage Serie</div>
        </div>
        <div class="stat-card">
            <div class="stat-value" id="thisMonth">0</div>
            <div class="stat-label">Diesen Monat</div>
        </div>
    </div>

    <!-- Search & Filter -->
    <div class="search-container">
        <div class="search-wrapper">
            <input type="text" class="search-input" id="searchInput" placeholder="Eintr√§ge durchsuchen..." oninput="filterEntries()">
        </div>
        <div class="filter-chips">
            <button class="filter-chip active" data-filter="all" onclick="setFilter('all')">Alle</button>
            <button class="filter-chip" data-filter="happy" onclick="setFilter('happy')">üòä Gl√ºcklich</button>
            <button class="filter-chip" data-filter="neutral" onclick="setFilter('neutral')">üòê Neutral</button>
            <button class="filter-chip" data-filter="sad" onclick="setFilter('sad')">üò¢ Traurig</button>
            <button class="filter-chip" data-filter="angry" onclick="setFilter('angry')">üò§ W√ºtend</button>
            <button class="filter-chip" data-filter="love" onclick="setFilter('love')">üòç Verliebt</button>
        </div>
    </div>

    <!-- Entries Container -->
    <div class="entries-container" id="entriesContainer">
        <!-- Entries will be rendered here -->
    </div>
</main>

<!-- Calendar View -->
<div class="main" id="calendarView" style="display: none;">
    <div class="calendar-nav">
        <button onclick="changeMonth(-1)">‚óÄ</button>
        <h3 id="calendarTitle">Dezember 2024</h3>
        <button onclick="changeMonth(1)">‚ñ∂</button>
    </div>
    <div class="calendar-grid" id="calendarGrid">
        <!-- Calendar will be rendered here -->
    </div>
    <div class="entries-container" id="calendarEntries">
        <!-- Selected day entries -->
    </div>
</div>

<!-- FAB Button -->
<button class="fab" onclick="showNewEntryModal()">+</button>

<!-- Bottom Navigation -->
<nav class="bottom-nav">
    <button class="nav-item active" onclick="switchView('entries')" data-view="entries">
        <span class="icon">üìù</span>
        Eintr√§ge
    </button>
    <button class="nav-item" onclick="switchView('calendar')" data-view="calendar">
        <span class="icon">üìÖ</span>
        Kalender
    </button>
    <button class="nav-item" onclick="switchView('stats')" data-view="stats">
        <span class="icon">üìä</span>
        Statistik
    </button>
</nav>

<!-- New/Edit Entry Modal -->
<div class="modal-overlay" id="entryModal">
    <div class="modal">
        <div class="modal-handle"></div>
        <h2 class="modal-title" id="modalTitle">Neuer Eintrag</h2>
        
        <form id="entryForm" onsubmit="saveEntry(event)">
            <input type="hidden" id="entryId">
            
            <div class="form-group">
                <label class="form-label">Wie f√ºhlst du dich?</label>
                <div class="mood-selector">
                    <button type="button" class="mood-option" data-mood="happy" onclick="selectMood('happy')">
                        üòä
                        <span>Gl√ºcklich</span>
                    </button>
                    <button type="button" class="mood-option" data-mood="neutral" onclick="selectMood('neutral')">
                        üòê
                        <span>Neutral</span>
                    </button>
                    <button type="button" class="mood-option" data-mood="sad" onclick="selectMood('sad')">
                        üò¢
                        <span>Traurig</span>
                    </button>
                    <button type="button" class="mood-option" data-mood="angry" onclick="selectMood('angry')">
                        üò§
                        <span>W√ºtend</span>
                    </button>
                    <button type="button" class="mood-option" data-mood="love" onclick="selectMood('love')">
                        üòç
                        <span>Verliebt</span>
                    </button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label">Titel</label>
                <input type="text" class="form-input" id="entryTitle" placeholder="Gib deinem Eintrag einen Titel..." required>
            </div>

            <div class="form-group">
                <label class="form-label">Was ist heute passiert?</label>
                <textarea class="form-input" id="entryContent" placeholder="Schreibe deine Gedanken nieder..." required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Tags (Enter zum Hinzuf√ºgen)</label>
                <div class="tags-input-container" id="tagsContainer">
                    <input type="text" class="tags-input" id="tagsInput" placeholder="Tag hinzuf√ºgen..." onkeydown="handleTagInput(event)">
                </div>
            </div>

            <button type="submit" class="btn-save">üíæ Speichern</button>
        </form>
    </div>
</div>

<!-- View Entry Modal -->
<div class="modal-overlay" id="viewModal">
    <div class="modal view-modal">
        <div class="modal-handle"></div>
        <div class="entry-meta">
            <div>
                <h2 id="viewTitle">Eintrag</h2>
                <p id="viewDate" style="color: var(--text-secondary); font-size: 0.9rem;"></p>
            </div>
            <span id="viewMood" style="font-size: 2rem;"></span>
        </div>
        <div class="entry-full-content" id="viewContent"></div>
        <div class="entry-tags" id="viewTags"></div>
        <div class="entry-actions" style="margin-top: 24px;">
            <button class="btn-edit" onclick="editFromView()">‚úèÔ∏è Bearbeiten</button>
            <button class="btn-delete" onclick="deleteFromView()">üóëÔ∏è L√∂schen</button>
        </div>
    </div>
</div>

<!-- Export Modal -->
<div class="modal-overlay" id="exportModal">
    <div class="modal">
        <div class="modal-handle"></div>
        <h2 class="modal-title">Exportieren</h2>
        <div class="export-options">
            <button class="export-btn" onclick="exportAsJSON()">
                <span class="icon">üìÑ</span>
                <div>
                    <strong>Als JSON</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">F√ºr Backup & Import</p>
                </div>
            </button>
            <button class="export-btn" onclick="exportAsText()">
                <span class="icon">üìù</span>
                <div>
                    <strong>Als Text</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">Lesbare Textdatei</p>
                </div>
            </button>
            <button class="export-btn" onclick="document.getElementById('importFile').click()">
                <span class="icon">üì•</span>
                <div>
                    <strong>Importieren</strong>
                    <p style="font-size: 0.8rem; color: var(--text-secondary);">JSON-Backup laden</p>
                </div>
            </button>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importFromJSON(event)">
        </div>
    </div>
</div>

<!-- Stats View -->
<div class="main" id="statsView" style="display: none;">
    <div class="stat-card" style="margin-bottom: 16px;">
        <h3 style="margin-bottom: 16px;">Stimmungsverteilung</h3>
        <div id="moodChart" style="display: flex; gap: 8px; justify-content: center;"></div>
    </div>
    <div class="stat-card" style="margin-bottom: 16px;">
        <h3 style="margin-bottom: 16px;">Schreibaktivit√§t</h3>
        <div id="activityStats"></div>
    </div>
    <div class="stat-card">
        <h3 style="margin-bottom: 16px;">H√§ufigste Tags</h3>
        <div id="topTags" class="entry-tags"></div>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast"></div>

<script>
    // App State
    let entries = JSON.parse(localStorage.getItem('diary_entries')) || [];
    let currentMood = null;
    let currentTags = [];
    let currentFilter = 'all';
    let currentViewId = null;
    let currentMonth = new Date();

    // Mood Data
    const moodEmojis = {
        happy: 'üòä',
        neutral: 'üòê',
        sad: 'üò¢',
        angry: 'üò§',
        love: 'üòç'
    };

    const moodNames = {
        happy: 'Gl√ºcklich',
        neutral: 'Neutral',
        sad: 'Traurig',
        angry: 'W√ºtend',
        love: 'Verliebt'
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        renderEntries();
        updateStats();
        setupModalClose();
    });

    // Modal Close on Background Click
    function setupModalClose() {
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
    }

    // Show New Entry Modal
    function showNewEntryModal() {
        document.getElementById('modalTitle').textContent = 'Neuer Eintrag';
        document.getElementById('entryId').value = '';
        document.getElementById('entryTitle').value = '';
        document.getElementById('entryContent').value = '';
        currentMood = null;
        currentTags = [];
        renderTags();
        document.querySelectorAll('.mood-option').forEach(opt => opt.classList.remove('selected'));
        document.getElementById('entryModal').classList.add('active');
    }

    // Select Mood
    function selectMood(mood) {
        currentMood = mood;
        document.querySelectorAll('.mood-option').forEach(opt => {
            opt.classList.toggle('selected', opt.dataset.mood === mood);
        });
    }

    // Handle Tag Input
    function handleTagInput(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const input = e.target;
            const tag = input.value.trim().toLowerCase();
            if (tag && !currentTags.includes(tag)) {
                currentTags.push(tag);
                renderTags();
            }
            input.value = '';
        }
    }

    // Render Tags
    function renderTags() {
        const container = document.getElementById('tagsContainer');
        const input = document.getElementById('tagsInput');
        container.innerHTML = '';
        currentTags.forEach((tag, index) => {
            const tagEl = document.createElement('span');
            tagEl.className = 'tag';
            tagEl.innerHTML = `${tag} <span class="tag-remove" onclick="removeTag(${index})">‚úï</span>`;
            container.appendChild(tagEl);
        });
        container.appendChild(input);
    }

    // Remove Tag
    function removeTag(index) {
        currentTags.splice(index, 1);
        renderTags();
    }

    // Save Entry
    function saveEntry(e) {
        e.preventDefault();
        
        const id = document.getElementById('entryId').value;
        const title = document.getElementById('entryTitle').value.trim();
        const content = document.getElementById('entryContent').value.trim();

        if (!currentMood) {
            showToast('Bitte w√§hle eine Stimmung aus');
            return;
        }

        const entry = {
            id: id || Date.now().toString(),
            title,
            content,
            mood: currentMood,
            tags: [...currentTags],
            createdAt: id ? entries.find(e => e.id === id)?.createdAt : new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };

        if (id) {
            const index = entries.findIndex(e => e.id === id);
            entries[index] = entry;
            showToast('Eintrag aktualisiert! ‚ú®');
        } else {
            entries.unshift(entry);
            showToast('Eintrag gespeichert! üéâ');
        }

        saveToStorage();
        renderEntries();
        updateStats();
        document.getElementById('entryModal').classList.remove('active');
    }

    // Render Entries
    function renderEntries() {
        const container = document.getElementById('entriesContainer');
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        
        let filtered = entries.filter(entry => {
            const matchesFilter = currentFilter === 'all' || entry.mood === currentFilter;
            const matchesSearch = !searchTerm || 
                entry.title.toLowerCase().includes(searchTerm) ||
                entry.content.toLowerCase().includes(searchTerm) ||
                entry.tags.some(t => t.includes(searchTerm));
            return matchesFilter && matchesSearch;
        });

        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìî</div>
                    <h2>${entries.length === 0 ? 'Noch keine Eintr√§ge' : 'Keine Ergebnisse'}</h2>
                    <p>${entries.length === 0 ? 'Tippe auf + um deinen ersten Eintrag zu schreiben' : 'Versuche andere Suchbegriffe oder Filter'}</p>
                </div>
            `;
            return;
        }

        container.innerHTML = filtered.map((entry, index) => `
            <div class="entry-card mood-${entry.mood}" style="animation-delay: ${index * 0.05}s" onclick="viewEntry('${entry.id}')">
                <div class="entry-header">
                    <span class="entry-date">${formatDate(entry.createdAt)}</span>
                    <span class="entry-mood">${moodEmojis[entry.mood]}</span>
                </div>
                <h3 class="entry-title">${escapeHtml(entry.title)}</h3>
                <p class="entry-preview">${escapeHtml(entry.content)}</p>
                ${entry.tags.length > 0 ? `
                    <div class="entry-tags">
                        ${entry.tags.map(tag => `<span class="tag">#${tag}</span>`).join('')}
                    </div>
                ` : ''}
                <div class="entry-actions" onclick="event.stopPropagation()">
                    <button class="btn-edit" onclick="editEntry('${entry.id}')">‚úèÔ∏è Bearbeiten</button>
                    <button class="btn-delete" onclick="deleteEntry('${entry.id}')">üóëÔ∏è L√∂schen</button>
                </div>
            </div>
        `).join('');
    }

    // View Entry
    function viewEntry(id) {
        const entry = entries.find(e => e.id === id);
        if (!entry) return;
        
        currentViewId = id;
        document.getElementById('viewTitle').textContent = entry.title;
        document.getElementById('viewDate').textContent = formatDate(entry.createdAt, true);
        document.getElementById('viewMood').textContent = moodEmojis[entry.mood];
        document.getElementById('viewContent').textContent = entry.content;
        document.getElementById('viewTags').innerHTML = entry.tags.map(tag => `<span class="tag">#${tag}</span>`).join('');
        document.getElementById('viewModal').classList.add('active');
    }

    // Edit from View
    function editFromView() {
        document.getElementById('viewModal').classList.remove('active');
        editEntry(currentViewId);
    }

    // Delete from View
    function deleteFromView() {
        document.getElementById('viewModal').classList.remove('active');
        deleteEntry(currentViewId);
    }

    // Edit Entry
    function editEntry(id) {
        const entry = entries.find(e => e.id === id);
        if (!entry) return;

        document.getElementById('modalTitle').textContent = 'Eintrag bearbeiten';
        document.getElementById('entryId').value = entry.id;
        document.getElementById('entryTitle').value = entry.title;
        document.getElementById('entryContent').value = entry.content;
        currentMood = entry.mood;
        currentTags = [...entry.tags];
        
        document.querySelectorAll('.mood-option').forEach(opt => {
            opt.classList.toggle('selected', opt.dataset.mood === entry.mood);
        });
        
        renderTags();
        document.getElementById('entryModal').classList.add('active');
    }

    // Delete Entry
    function deleteEntry(id) {
        if (confirm('M√∂chtest du diesen Eintrag wirklich l√∂schen?')) {
            entries = entries.filter(e => e.id !== id);
            saveToStorage();
            renderEntries();
            updateStats();
            showToast('Eintrag gel√∂scht üóëÔ∏è');
        }
    }

    // Filter
    function setFilter(filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.classList.toggle('active', chip.dataset.filter === filter);
        });
        renderEntries();
    }

    function filterEntries() {
        renderEntries();
    }

    // Update Stats
    function updateStats() {
        document.getElementById('totalEntries').textContent = entries.length;
        
        // Calculate streak
        let streak = 0;
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        for (let i = 0; i < 365; i++) {
            const checkDate = new Date(today);
            checkDate.setDate(checkDate.getDate() - i);
            const dateStr = checkDate.toISOString().split('T')[0];
            
            const hasEntry = entries.some(e => e.createdAt.split('T')[0] === dateStr);
            if (hasEntry) {
                streak++;
            } else if (i > 0) {
                break;
            }
        }
        document.getElementById('currentStreak').textContent = streak;

        // This month
        const thisMonth = new Date().toISOString().slice(0, 7);
        const monthEntries = entries.filter(e => e.createdAt.slice(0, 7) === thisMonth).length;
        document.getElementById('thisMonth').textContent = monthEntries;
    }

    // Save to LocalStorage
    function saveToStorage() {
        localStorage.setItem('diary_entries', JSON.stringify(entries));
    }

    // View Switching
    function switchView(view) {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.toggle('active', item.dataset.view === view);
        });
        
        document.getElementById('mainContent').style.display = view === 'entries' ? 'block' : 'none';
        document.getElementById('calendarView').style.display = view === 'calendar' ? 'block' : 'none';
        document.getElementById('statsView').style.display = view === 'stats' ? 'block' : 'none';
        
        document.querySelector('.fab').style.display = view === 'entries' ? 'flex' : 'none';

        if (view === 'calendar') renderCalendar();
        if (view === 'stats') renderStats();
    }

    // Calendar
    function renderCalendar() {
        const grid = document.getElementById('calendarGrid');
        const year = currentMonth.getFullYear();
        const month = currentMonth.getMonth();
        
        document.getElementById('calendarTitle').textContent = 
            new Date(year, month).toLocaleDateString('de-DE', { month: 'long', year: 'numeric' });

        const days = ['So', 'Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa'];
        let html = days.map(d => `<div class="calendar-header">${d}</div>`).join('');

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const today = new Date().toISOString().split('T')[0];

        // Previous month days
        const prevMonthDays = new Date(year, month, 0).getDate();
        for (let i = firstDay - 1; i >= 0; i--) {
            html += `<div class="calendar-day other-month">${prevMonthDays - i}</div>`;
        }

        // Current month days
        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const hasEntry = entries.some(e => e.createdAt.split('T')[0] === dateStr);
            const isToday = dateStr === today;
            
            html += `<div class="calendar-day${hasEntry ? ' has-entry' : ''}${isToday ? ' today' : ''}" 
                onclick="showDayEntries('${dateStr}')">${day}</div>`;
        }

        // Next month days
        const remainingDays = 42 - firstDay - daysInMonth;
        for (let i = 1; i <= remainingDays; i++) {
            html += `<div class="calendar-day other-month">${i}</div>`;
        }

        grid.innerHTML = html;
    }

    function changeMonth(delta) {
        currentMonth.setMonth(currentMonth.getMonth() + delta);
        renderCalendar();
    }

    function showDayEntries(dateStr) {
        const dayEntries = entries.filter(e => e.createdAt.split('T')[0] === dateStr);
        const container = document.getElementById('calendarEntries');
        
        if (dayEntries.length === 0) {
            container.innerHTML = `<p style="text-align: center; color: var(--text-secondary);">Keine Eintr√§ge an diesem Tag</p>`;
            return;
        }

        container.innerHTML = dayEntries.map(entry => `
            <div class="entry-card mood-${entry.mood}" onclick="viewEntry('${entry.id}')">
                <div class="entry-header">
                    <span class="entry-date">${formatDate(entry.createdAt)}</span>
                    <span class="entry-mood">${moodEmojis[entry.mood]}</span>
                </div>
                <h3 class="entry-title">${escapeHtml(entry.title)}</h3>
                <p class="entry-preview">${escapeHtml(entry.content)}</p>
            </div>
        `).join('');
    }

    // Stats View
    function renderStats() {
        // Mood Chart
        const moodCounts = { happy: 0, neutral: 0, sad: 0, angry: 0, love: 0 };
        entries.forEach(e => moodCounts[e.mood]++);
        
        const maxCount = Math.max(...Object.values(moodCounts), 1);
        const moodChart = document.getElementById('moodChart');
        moodChart.innerHTML = Object.entries(moodCounts).map(([mood, count]) => `
            <div style="text-align: center;">
                <div style="height: 100px; display: flex; align-items: flex-end; justify-content: center;">
                    <div style="width: 30px; height: ${(count / maxCount) * 100}%; background: var(--primary); border-radius: 4px;"></div>
                </div>
                <div style="font-size: 1.2rem; margin-top: 8px;">${moodEmojis[mood]}</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">${count}</div>
            </div>
        `).join('');

        // Activity Stats
        const activityStats = document.getElementById('activityStats');
        const avgLength = entries.length > 0 
            ? Math.round(entries.reduce((sum, e) => sum + e.content.length, 0) / entries.length)
            : 0;
        
        activityStats.innerHTML = `
            <p style="margin-bottom: 8px;">üìù Durchschnittliche L√§nge: <strong>${avgLength} Zeichen</strong></p>
            <p>üìÖ Erster Eintrag: <strong>${entries.length > 0 ? formatDate(entries[entries.length - 1].createdAt) : 'Noch keine'}</strong></p>
        `;

        // Top Tags
        const tagCounts = {};
        entries.forEach(e => e.tags.forEach(t => tagCounts[t] = (tagCounts[t] || 0) + 1));
        const sortedTags = Object.entries(tagCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
        
        document.getElementById('topTags').innerHTML = sortedTags.length > 0
            ? sortedTags.map(([tag, count]) => `<span class="tag">#${tag} (${count})</span>`).join('')
            : '<p style="color: var(--text-secondary);">Noch keine Tags</p>';
    }

    // Export Functions
    function showExportModal() {
        document.getElementById('exportModal').classList.add('active');
    }

    function exportAsJSON() {
        const data = JSON.stringify(entries, null, 2);
        downloadFile(data, 'tagebuch-backup.json', 'application/json');
        showToast('JSON exportiert! üìÑ');
        document.getElementById('exportModal').classList.remove('active');
    }

    function exportAsText() {
        let text = 'üìî MEIN TAGEBUCH\n' + '='.repeat(50) + '\n\n';
        
        entries.forEach(entry => {
            text += `${moodEmojis[entry.mood]} ${entry.title}\n`;
            text += `üìÖ ${formatDate(entry.createdAt, true)}\n`;
            text += '-'.repeat(30) + '\n';
            text += entry.content + '\n';
            if (entry.tags.length > 0) {
                text += `üè∑Ô∏è ${entry.tags.map(t => '#' + t).join(' ')}\n`;
            }
            text += '\n' + '='.repeat(50) + '\n\n';
        });

        downloadFile(text, 'tagebuch.txt', 'text/plain');
        showToast('Text exportiert! üìù');
        document.getElementById('exportModal').classList.remove('active');
    }

    function importFromJSON(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            try {
                const imported = JSON.parse(e.target.result);
                if (Array.isArray(imported)) {
                    if (confirm(`${imported.length} Eintr√§ge gefunden. M√∂chtest du sie importieren? (Bestehende Eintr√§ge bleiben erhalten)`)) {
                        entries = [...imported, ...entries];
                        saveToStorage();
                        renderEntries();
                        updateStats();
                        showToast(`${imported.length} Eintr√§ge importiert! üéâ`);
                    }
                }
            } catch (err) {
                showToast('Fehler beim Import üòï');
            }
        };
        reader.readAsText(file);
        event.target.value = '';
        document.getElementById('exportModal').classList.remove('active');
    }

    function downloadFile(content, filename, type) {
        const blob = new Blob([content], { type });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    // Theme Toggle
    function toggleTheme() {
        document.body.classList.toggle('light-theme');
        showToast('Theme gewechselt! üé®');
    }

    // Toast
    function showToast(message) {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.classList.add('show');
        setTimeout(() => toast.classList.remove('show'), 3000);
    }

    // Utilities
    function formatDate(isoString, full = false) {
        const date = new Date(isoString);
        if (full) {
            return date.toLocaleDateString('de-DE', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        return date.toLocaleDateString('de-DE', { 
            day: 'numeric', 
            month: 'short', 
            year: 'numeric' 
        });
    }

    function escapeHtml(text) {
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }
</script>
```

</body>
</html>