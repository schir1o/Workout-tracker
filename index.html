<!DOCTYPE html>

<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#007AFF">
<title>Darios Gym</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;background:#000;color:#fff;padding:0;margin:0;overscroll-behavior:none;position:fixed;width:100%;height:100%;overflow:hidden}
.app{height:100vh;display:flex;flex-direction:column;padding-top:env(safe-area-inset-top)}
.header{background:linear-gradient(135deg,#007AFF,#0051D5);padding:20px;padding-top:calc(20px + env(safe-area-inset-top))}
.header h1{font-size:28px;font-weight:700;margin-bottom:16px}
.nav{display:flex;gap:8px;align-items:center}
.nav-btn{background:rgba(255,255,255,0.15);border:none;color:#fff;padding:12px 20px;border-radius:12px;font-size:18px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;min-width:44px;min-height:44px}
.nav-btn:active{background:rgba(255,255,255,0.25)}
.date-btn{flex:1;text-align:center}
.content{flex:1;overflow-y:auto;-webkit-overflow-scrolling:touch;padding:16px;padding-bottom:calc(100px + env(safe-area-inset-bottom))}
.card{background:#1c1c1e;border-radius:16px;padding:16px;margin-bottom:16px}
.exercise{background:#2c2c2e;border-radius:12px;padding:14px;margin-bottom:12px}
.exercise-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;gap:8px}
.exercise-name{font-size:18px;font-weight:600;flex:1}
.muscle-tag{background:#007AFF;padding:4px 10px;border-radius:8px;font-size:13px;font-weight:600;white-space:nowrap}
.delete-btn{background:#FF3B30;border:none;color:#fff;width:36px;height:36px;border-radius:8px;font-size:20px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.set{display:grid;grid-template-columns:40px 1fr 80px 50px;gap:8px;align-items:center;padding:10px;background:#1c1c1e;border-radius:10px;margin-bottom:8px}
.set.done{background:rgba(52,199,89,0.15);border:1px solid #34C759}
.set-num{width:40px;height:40px;background:#007AFF;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:16px}
.set.done .set-num{background:#34C759}
.input{background:#000;border:1px solid #3a3a3c;border-radius:8px;padding:10px;color:#fff;font-size:17px;text-align:center;width:100%;-webkit-appearance:none}
.input:focus{border-color:#007AFF;outline:none}
.check-btn{width:50px;height:44px;border-radius:10px;background:#2c2c2e;border:2px solid #3a3a3c;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:22px}
.check-btn.checked{background:#34C759;border-color:#34C759;color:#fff}
.empty{text-align:center;padding:60px 20px;color:#8E8E93}
.empty small{display:block;margin-top:8px;font-size:14px}
.add-btn{width:100%;padding:16px;background:#007AFF;border:none;border-radius:12px;color:#fff;font-size:17px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:8px}
.add-btn:active{transform:scale(0.98)}
.bottom-bar{position:fixed;bottom:0;left:0;right:0;background:#1c1c1e;padding:12px 16px;padding-bottom:calc(12px + env(safe-area-inset-bottom));display:flex;gap:8px;border-top:1px solid #3a3a3c}
.bottom-btn{flex:1;padding:12px;background:#2c2c2e;border:none;border-radius:10px;color:#fff;font-size:14px;font-weight:600;display:flex;flex-direction:column;align-items:center;gap:4px;cursor:pointer}
.bottom-btn.export{background:#5A5A5E}
.bottom-btn.import{background:#5A5A5E}
.bottom-btn.github{background:#34C759}
.bottom-btn span{font-size:20px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);z-index:999;display:none;align-items:flex-end;padding:0}
.modal.open{display:flex}
.modal-content{background:#1c1c1e;border-radius:20px 20px 0 0;padding:24px;width:100%;max-height:90vh;overflow-y:auto;padding-bottom:calc(24px + env(safe-area-inset-bottom))}
.modal h3{font-size:22px;font-weight:700;margin-bottom:20px}
.form-group{margin-bottom:20px}
.label{display:block;margin-bottom:8px;font-size:13px;font-weight:600;color:#8E8E93;text-transform:uppercase;letter-spacing:0.5px}
input[type="text"],input[type="number"],input[type="password"],select{width:100%;padding:14px;background:#2c2c2e;border:1px solid #3a3a3c;border-radius:10px;color:#fff;font-size:17px;-webkit-appearance:none}
select{cursor:pointer}
.modal-btn{width:100%;padding:16px;border:none;border-radius:12px;font-size:17px;font-weight:600;cursor:pointer;margin-bottom:10px}
.modal-btn.primary{background:#007AFF;color:#fff}
.modal-btn.secondary{background:#3a3a3c;color:#fff}
.modal-btn.success{background:#34C759;color:#fff}
input[type="date"]{position:absolute;opacity:0;pointer-events:none}
</style>
</head>
<body>
<div class="app">
<div class="header">
<h1>üí™ Darios Gym</h1>
<div class="nav">
<button class="nav-btn" onclick="cd(-1)">‚Üê</button>
<input type="date" id="di" onchange="sd(this.value)">
<button class="nav-btn date-btn" onclick="$('di').style.pointerEvents='auto';$('di').click();$('di').style.pointerEvents='none'" id="dd"></button>
<button class="nav-btn" onclick="cd(1)">‚Üí</button>
</div>
</div>

<div class="content" id="ex"></div>

<div class="bottom-bar">
<button class="bottom-btn export" onclick="xp()">
<span>üì§</span>
Export
</button>
<button class="bottom-btn import" onclick="im()">
<span>üì•</span>
Import
</button>
<button class="bottom-btn github" onclick="cs()">
<span>‚òÅÔ∏è</span>
GitHub
</button>
</div>
</div>

<div class="modal" id="am" onclick="if(event.target.id=='am')cm('am')">
<div class="modal-content">
<h3>Neue √úbung</h3>
<div class="form-group">
<label class="label">Name</label>
<input type="text" id="nn" placeholder="z.B. Bankdr√ºcken" autocomplete="off">
</div>
<div class="form-group">
<label class="label">S√§tze</label>
<input type="number" id="ns" value="3" min="1" max="10" inputmode="numeric">
</div>
<div class="form-group">
<label class="label">Wiederholungen</label>
<input type="text" id="nr" value="8-12" placeholder="8-12" autocomplete="off">
</div>
<div class="form-group">
<label class="label">Typ</label>
<select id="nt">
<option value="kg">Gewicht (kg)</option>
<option value="m">Distanz (m)</option>
<option value="min">Zeit (min)</option>
</select>
</div>
<div class="form-group">
<label class="label">Muskelgruppe</label>
<select id="nm">
<option value="Brust">Brust</option>
<option value="R√ºcken">R√ºcken</option>
<option value="Beine">Beine</option>
<option value="Schultern">Schultern</option>
<option value="Arme">Arme</option>
<option value="Bauch">Bauch</option>
<option value="Cardio">Cardio</option>
<option value="Andere">Andere</option>
</select>
</div>
<button class="modal-btn primary" onclick="ae()">Hinzuf√ºgen</button>
<button class="modal-btn secondary" onclick="cm('am')">Abbrechen</button>
</div>
</div>

<script>
const $=id=>document.getElementById(id);
let dt=new Date().toISOString().split('T')[0];
let w={};

// Load/Save
function l(){try{w=JSON.parse(localStorage.getItem('w'))||{}}catch{}}
function s(){localStorage.setItem('w',JSON.stringify(w));if(localStorage.getItem('ght'))ghs()}

// Date
function fd(){
const d=new Date(dt+'T12:00');
const days=['So','Mo','Di','Mi','Do','Fr','Sa'];
const mo=days[d.getDay()];
const dd=d.getDate().toString().padStart(2,'0');
const mm=(d.getMonth()+1).toString().padStart(2,'0');
$('dd').textContent=`${mo}, ${dd}.${mm}.${d.getFullYear()}`;
$('di').value=dt;
}

function cd(n){
const d=new Date(dt+'T12:00');
d.setDate(d.getDate()+n);
dt=d.toISOString().split('T')[0];
fd();r();
}

function sd(v){dt=v;fd();r()}

// Render
function r(){
const k=dt;
const d=w[k];
let h='';
if(!d||!d.e||d.e.length===0){
h='<div class="card empty">Noch keine Eintr√§ge<br><small>√úbung hinzuf√ºgen mit Button unten</small></div>';
}else{
d.e.forEach((x,i)=>{
const tp=x.t||'kg';
const ph=tp==='m'?'Meter':tp==='min'?'Minuten':'kg';
const ph2=tp==='kg'?'Wdh':'Zeit';
h+=`<div class="exercise">
<div class="exercise-header">
<div class="exercise-name">${x.n}</div>
<div class="muscle-tag">${x.m||'Andere'}</div>
<button class="delete-btn" onclick="if(confirm('√úbung wirklich l√∂schen?'))re(${i})">√ó</button>
</div>`;
x.s.forEach((s,j)=>{
h+=`<div class="set ${s.d?'done':''}">
<div class="set-num">${j+1}</div>
<input class="input" placeholder="${ph}" value="${s.w||''}" onchange="us(${i},${j},'w',this.value)" inputmode="${tp==='kg'?'decimal':'numeric'}">
<input class="input" placeholder="${ph2}" value="${s.r||''}" onchange="us(${i},${j},'r',this.value)" inputmode="numeric">
<button class="check-btn ${s.d?'checked':''}" onclick="tg(${i},${j})">${s.d?'‚úì':''}</button>
</div>`;
});
h+=`</div>`;
});
}
h+=`<button class="add-btn" onclick="$('am').classList.add('open')">‚ûï Neue √úbung</button>`;
$('ex').innerHTML=h;
}

// Update Set
function us(i,j,f,v){
const k=dt;
if(!w[k])w[k]={e:[]};
if(w[k].e[i]&&w[k].e[i].s[j]){
w[k].e[i].s[j][f]=v;
s();
}
}

// Toggle Done
function tg(i,j){
const k=dt;
if(w[k]&&w[k].e[i]&&w[k].e[i].s[j]){
w[k].e[i].s[j].d=!w[k].e[i].s[j].d;
s();r();
}
}

// Add Exercise
function ae(){
const n=$('nn').value.trim();
const st=parseInt($('ns').value)||3;
const rp=$('nr').value||'8-12';
const tp=$('nt').value||'kg';
const mg=$('nm').value||'Andere';
if(n){
const k=dt;
if(!w[k])w[k]={e:[]};
w[k].e.push({n,r:rp,t:tp,m:mg,s:Array(st).fill().map(()=>({w:'',r:'',d:0}))});
$('nn').value='';$('ns').value='3';$('nr').value='8-12';$('nt').value='kg';$('nm').value='Brust';
cm('am');s();r();
}
}

// Remove Exercise
function re(i){
const k=dt;
if(w[k]&&w[k].e){
w[k].e.splice(i,1);
if(w[k].e.length===0)delete w[k];
s();r();
}
}

// Close Modal
function cm(i){$(i).classList.remove('open')}

// Export
function xp(){
const d=JSON.stringify(w,null,2);
const b=new Blob([d],{type:'application/json'});
const u=URL.createObjectURL(b);
const a=document.createElement('a');
a.href=u;
a.download=`gym-${dt}.json`;
a.click();
}

// Import
function im(){
const i=document.createElement('input');
i.type='file';
i.accept='.json';
i.onchange=e=>{
const r=new FileReader();
r.onload=ev=>{
try{
w=JSON.parse(ev.target.result);
s();r();alert('‚úÖ Import erfolgreich!');
}catch{alert('‚ùå Fehler beim Import')}
};
r.readAsText(e.target.files[0]);
};
i.click();
}

// GitHub Dialog
function cs(){
const m=document.createElement('div');
m.className='modal open';
m.onclick=e=>{if(e.target===m)m.remove()};
m.innerHTML=`<div class="modal-content">
<h3>GitHub Sync</h3>
<div class="form-group"><label class="label">Token</label><input type="password" id="gt" placeholder="ghp_..." value="${localStorage.getItem('ght')||''}" autocomplete="off"></div>
<div class="form-group"><label class="label">Username</label><input type="text" id="gu" placeholder="dein-username" value="${localStorage.getItem('ghu')||''}" autocomplete="off"></div>
<div class="form-group"><label class="label">Repository</label><input type="text" id="gr" placeholder="Workout-tracker" value="${localStorage.getItem('ghr')||'Workout-tracker'}" autocomplete="off"></div>
<button class="modal-btn primary" onclick="gss()">Speichern & Aktivieren</button>
${localStorage.getItem('ght')?'<button class="modal-btn success" onclick="ghl().then(()=>{r();alert(\'‚úÖ Von GitHub geladen\')})">Von GitHub laden</button>':''}
<button class="modal-btn secondary" onclick="this.parentElement.parentElement.remove()">Abbrechen</button>
</div>`;
document.body.appendChild(m);
}

function gss(){
const t=$('gt').value,u=$('gu').value,r=$('gr').value;
if(t&&u){
localStorage.setItem('ght',t);
localStorage.setItem('ghu',u);
localStorage.setItem('ghr',r);
ghl().then(()=>{r();ghs()});
alert('‚úÖ Aktiviert');
document.querySelector('.modal').remove();
}
}

async function ghs(){
const t=localStorage.getItem('ght'),u=localStorage.getItem('ghu'),r=localStorage.getItem('ghr')||'Workout-tracker';
if(!t||!u)return;
try{
const d=btoa(unescape(encodeURIComponent(JSON.stringify({w,d:new Date()}))));
const s=await gsha();
await fetch(`https://api.github.com/repos/${u}/${r}/contents/data.json`,{
method:'PUT',
headers:{'Authorization':`token ${t}`},
body:JSON.stringify({message:`Update ${new Date().toLocaleString('de')}`,content:d,sha:s})
});
}catch(e){console.log('GitHub save error:',e)}
}

async function gsha(){
const t=localStorage.getItem('ght'),u=localStorage.getItem('ghu'),r=localStorage.getItem('ghr')||'Workout-tracker';
try{
const res=await fetch(`https://api.github.com/repos/${u}/${r}/contents/data.json`,{
headers:{'Authorization':`token ${t}`}
});
if(res.ok)return(await res.json()).sha;
}catch{}
}

async function ghl(){
const t=localStorage.getItem('ght'),u=localStorage.getItem('ghu'),r=localStorage.getItem('ghr')||'Workout-tracker';
if(!t||!u)return;
try{
const res=await fetch(`https://api.github.com/repos/${u}/${r}/contents/data.json`,{
headers:{'Authorization':`token ${t}`}
});
if(res.ok){
const d=await res.json();
const c=JSON.parse(decodeURIComponent(escape(atob(d.content))));
if(c.w){
w=c.w;
localStorage.setItem('w',JSON.stringify(w));
console.log('‚úÖ Von GitHub geladen');
}
}else if(res.status===404){
console.log('üìù Erstelle neue data.json mit leeren Daten');
w={};
await ghs();
}
}catch(e){console.log('GitHub load error:',e)}
}

// Init
fd();
if(localStorage.getItem('ght')){
ghl().then(()=>r());
}else{
l();
r();
}

// iOS optimizations
document.addEventListener('touchmove',e=>{if(e.scale!==1)e.preventDefault()},{passive:false});
</script>

</body>
</html>